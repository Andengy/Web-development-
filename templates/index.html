<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard</title>
    <link rel="stylesheet" href="/static/styles.css">
    <script src="https://unpkg.com/htmx.org@1.6.1"></script> <!-- Include HTMX -->
</head>
<body>
    <header>
        <div class="navbar">
            <h1 class="app-name">Weather App Zephyr Group</h1>
            <nav class="menu">
                <button onclick="navigate('home')">HOME</button>
                <button onclick="navigate('about')">ABOUT</button>
                <button onclick="navigate('account')">ACCOUNT</button>
            </nav>
            <div class="icon moon-icon" id="theme-toggle" onclick="toggleTheme()"></div>
        </div>
    </header>

    <main>
        <div class="weather-container">
            <div class="weather-left">
                <!-- Search bar for city input with HTMLx -->
                <form id="search-form" class="search-bar" hx-post="/search_location" hx-trigger="submit" hx-target="this" hx-swap="none" hx-on:afterRequest="updateWeather">
                    <input type="text" name="city" id="search-city" placeholder="Enter city" required />
                    <button type="submit">Search</button>
                </form>
                
                <!-- Today's Weather Box -->
                <div class="weather-today" id="weather-today">
                    <div class="weather-icon" id="today-weather-icon">--</div> <!-- Weather icon for today's box -->
                    <div class="weather-text">Temperature Now: <span id="current-temp">--</span>¬∞C</div>
                </div>
            </div>

            <!-- Weather Stats Boxes -->
            <div id="weather-stats" class="weather-stats">
                <!-- Date Box -->
                <div class="stat-box">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat">Date: <span id="date">--</span></div>
                </div>
                <!-- Time Box with Emoji -->
                <div class="stat-box">
                    <div class="stat-icon" id="time-emoji">--</div>
                    <div class="stat">Time: <span id="time">--</span></div>
                </div>
                <!-- Precipitation Box -->
                <div class="stat-box">
                    <div class="stat-icon">üåßÔ∏è</div>
                    <div class="stat">Precipitation: <span id="precipitation">--</span>%</div>
                </div>
                <!-- Humidity Box -->
                <div class="stat-box">
                    <div class="stat-icon">üíß</div>
                    <div class="stat">Humidity: <span id="humidity">--</span>%</div>
                </div>
                <!-- Max Temperature Box -->
                <div class="stat-box">
                    <div class="stat-icon">üî•</div>
                    <div class="stat">Max Temp: <span id="hottest-temp">--</span>¬∞C</div>
                </div>
                <!-- Min Temperature Box -->
                <div class="stat-box">
                    <div class="stat-icon">‚ùÑÔ∏è</div>
                    <div class="stat">Min Temp: <span id="coldest-temp">--</span>¬∞C</div>
                </div>
                <!-- Wind Speed Box -->
                <div class="stat-box">
                    <div class="stat-icon">üí®</div>
                    <div class="stat">Wind Speed: <span id="windspeed">--</span> m/s</div>
                </div>
                <!-- UV Index Box -->
                <div class="stat-box">
                    <div class="stat-icon">‚òÄÔ∏è</div>
                    <div class="stat">UV Index: <span id="uv-index">--</span></div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 Weather Dashboard</p>
    </footer>

    <script>
        // JavaScript function to update weather data after receiving response from server
        function updateWeather(event) {
            console.log("updateWeather function called"); // Debugging statement
            let data = event.detail.xhr.response;
    
            // If data is not a string, there's no need to parse
            if (typeof data === 'string') {
                try {
                    data = JSON.parse(data);
                } catch (e) {
                    console.error("Error parsing data:", e);
                    return;
                }
            }
    
            console.log("Parsed response data:", data); // Debugging statement
            
            document.getElementById("current-temp").innerText = data.temperature || "--";
            document.getElementById("today-weather-icon").innerText = data.description || "--";
            document.getElementById("date").innerText = new Date(data.date * 1000).toLocaleDateString() || "--";
            document.getElementById("precipitation").innerText = data.precipitation || "--";
            document.getElementById("humidity").innerText = data.humidity || "--";
            document.getElementById("hottest-temp").innerText = data.max_temp || "--";
            document.getElementById("coldest-temp").innerText = data.min_temp || "--";
            document.getElementById("windspeed").innerText = data.wind_speed || "--";
            document.getElementById("uv-index").innerText = data.uv_index || "--";
        }
    </script>
    
</body>
</html>
